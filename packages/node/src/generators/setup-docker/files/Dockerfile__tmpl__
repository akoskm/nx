# Stage 1: Build
FROM docker.io/node:lts-alpine AS build

ENV HOST=0.0.0.0
ENV PORT=3000

WORKDIR /app

RUN addgroup --system <%= sanitizedProjectName %> && \
          adduser --system -G <%= sanitizedProjectName %> <%= sanitizedProjectName %> \

COPY <%= buildLocation %> <%= sanitizedProjectName %>/
COPY <%= projectPath %>/package.json <%= sanitizedProjectName %>/
RUN chown -R <%= sanitizedProjectName %>:<%= sanitizedProjectName %> .

# You can remove this install step if you build with `--bundle` option.
# The bundled output will include external dependencies.
RUN npm --prefix <%= sanitizedProjectName %> --omit=dev -f install

# Stage 2: Production
FROM docker.io/node:lts-apline
WORKDIR /app
COPY --from=build /app/<%= sanitizedProjectName %> <%= sanitizedProjectName %>/

CMD [ "node", "<%= sanitizedProjectName %>" ]
